



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-dans-4.4.1">
    
    
      
        <title>Common practices - easy-module-archetype</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.27a306a7.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700|Glegoo:300,400,400i,700|Ubuntu+Mono&display=swap">
        <style>.body-type,body,input{font-family:"Open Sans",sans-serif}.head-type,h1,h2,h3,h4,h5{font-family:"Glegoo",serif}.code-type,code,kbd,pre{font-family:"Ubuntu Mono",monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#common-practices" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      

<header class="md-header" data-md-component="header">

  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://dans.knaw.nl/en" title="Data Archiving and Networked Services (DANS)" class="md-header-nav__button md-logo">
          <img src="../assets/images/DANS.gif" height="50">
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="easy-module-archetype" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title head-type" data-md-component="title">
          
            <span class="md-header-nav__topic">
              easy-module-archetype
              
            </span>
            <span class="md-header-nav__topic">
              
                Common practices
              
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/DANS-KNAW/easy-module-archetype/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    DANS-KNAW/easy-module-archetype
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title head-type md-nav__title--site" for="__drawer">
    <a href=".." title="easy-module-archetype" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    easy-module-archetype
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/DANS-KNAW/easy-module-archetype/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    DANS-KNAW/easy-module-archetype
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Manual" class="md-nav__link head-type">
      Manual
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active head-type" for="__toc">
        Common practices
      </label>
    
    <a href="./" title="Common practices" class="md-nav__link md-nav__link--active head-type">
      Common practices
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title head-type" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#code-style" title="Code Style" class="md-nav__link head-type">
    Code Style
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-management" title="Resource Management" class="md-nav__link head-type">
    Resource Management
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link head-type">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging" title="Debugging" class="md-nav__link head-type">
    Debugging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packaging-and-installation" title="Packaging and Installation" class="md-nav__link head-type">
    Packaging and Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" title="Documentation" class="md-nav__link head-type">
    Documentation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title head-type" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#code-style" title="Code Style" class="md-nav__link head-type">
    Code Style
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-management" title="Resource Management" class="md-nav__link head-type">
    Resource Management
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link head-type">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging" title="Debugging" class="md-nav__link head-type">
    Debugging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packaging-and-installation" title="Packaging and Installation" class="md-nav__link head-type">
    Packaging and Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" title="Documentation" class="md-nav__link head-type">
    Documentation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/DANS-KNAW/easy-module-archetype/edit/master/docs/common-practices.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="common-practices">Common Practices<a class="headerlink" href="#common-practices" title="Permanent link">&para;</a></h1>
<h2 id="code-style">Code Style<a class="headerlink" href="#code-style" title="Permanent link">&para;</a></h2>
<ul>
<li>Use one directory for all the packages from the <code>nl</code> package down to the top-level package
  for the project, for example <code>nl.knaw.dans.easy.mymodule</code> should be a directory (with dots
  in its name). Sub-packages of <code>mymodule</code> should be one directory per package (Java-style).
  <em>(Rationale: easier to navigate when using tools with no support for Java packagges, e.g.,
   when working from the command line. Also, the packages <code>nl</code> through <code>easy</code> are never used
   to contain resources directly.)</em></li>
<li>Use the code formatting settings as specified in <a href="https://raw.githubusercontent.com/DANS-KNAW/easy-module-archetype/master/dans-intellij-codestyles.xml">dans-intellij-codestyles.xml</a>.
  <em>(Rationale: too much variation in code formatting distracts from the code logic
   (or lack thereof ;-). Git diffs only show relevant changes in code text.)</em></li>
<li>Use the code inspection settings an specified in <a href="https://raw.githubusercontent.com/DANS-KNAW/easy-module-archetype/master/dans-intellij-inspections.xml">dans-intellij-inspections.xml</a>.
  <em>(Rationale: too much variation in code conventions distracts from the code logic.)</em></li>
</ul>
<h2 id="resource-management">Resource Management<a class="headerlink" href="#resource-management" title="Permanent link">&para;</a></h2>
<ul>
<li>Use the <code>java.nio</code> API rather than <code>java.io</code>, for example prefer <code>java.nio.files.Path</code>
  over <code>java.io.File</code> and the functions in  <code>java.nio.files.Paths</code> over the <code>java.io.File</code>
  methods. When using libraries that expect <code>java.io.File</code> objects as parameters, convert
  them at the last possible moment.</li>
<li>Use the <code>scala-arm</code> library to ensure that resources are closed, instead of doing it
  manually (e.g., in <code>finally</code> blocks).</li>
<li>Save text content (including XML) as UTF-8 encoded. Use the <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/charset/StandardCharsets.html#UTF_8">StandardCharsets constant</a> for this, rather than
  a magic string.</li>
<li>Do not assume that XML is UTF-8 encoded, but instead let the parser use the <code>encoding</code> attribute
  in the XML prolog.</li>
</ul>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<ul>
<li>We use the following predefined testing levels. Each test should belong clearly
  under one of these. For each level we have or will develop common practices.<ul>
<li>Unit tests (test one function)</li>
<li>Service- and consumer tests</li>
<li>End-to-end tests</li>
</ul>
</li>
<li>Prefer unit tests (single function) over service test (exercises the whole service).</li>
<li>Do not let some side effect of your unit test, such as artifacts produced, drive their
  development. <em>(Rationale: unit tests must be small in scope, coherent and clear, so that
  they are easily evolved in tandem with the code they test. "Small in scope" means they
  depend on little else than the code under test, but also that other things do not
  depend on them.)</em></li>
<li>Every unit test must copy and process any file data it uses to the directory <code>target/test/&lt;test-simple-classname&gt;</code>.
  An exception can be made if the unit test only reads and does not write <em>any</em> data.
  <em>(Rationale: this convention makes it easier to find the data, when debugging the unit tests)</em></li>
<li>Prefer making the input data part of the unit test source text over reading it from a file. A
  trade-off needs to be made here. Input data in the source code makes it more readily available when
  reading the test, but if the input is very large it may obscure the test logic.</li>
<li>Every unit test must start with a clean slate, even if this means copying the same files multiple times.
  <em>(Rationale: the extra time spent copying the files will be marginal, while it makes it much easier to
  comprehend what is going on in a specific test.)</em></li>
<li>Do clean-up at the start of the test and not at the end. <em>(Rationale: when running individual
  unit tests it is then easier to diagnose problems. Since all the data is put under <code>target</code> a
  <code>mvn clean</code> will clean up everything anyway.)</em>  </li>
<li>Avoid all branching logic and most iteration logic in the unit tests. <em>(Rationale: the tests should
  focus on the pre- and post-conditions of the function under test. It should be readily comprehensible
  what data goes in and what is supposed to come out. Branching logic obscures this. Processing
  efficiency and <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a> are of lower priority, here.)</em></li>
</ul>
<h2 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">&para;</a></h2>
<ul>
<li>We use the following predefined ways to start the application under test. Do not introduce new ways.<ul>
<li>Start with maven <code>run.sh</code>, <code>run-wait.sh</code> or <code>run-service.sh</code>. The latter two can be used to 
  start a debugging session in the IDE by attaching to the running process.</li>
<li>Deploy to test VM (<code>deasy</code>) and start in the same way as in production.</li>
</ul>
</li>
</ul>
<h2 id="packaging-and-installation">Packaging and Installation<a class="headerlink" href="#packaging-and-installation" title="Permanent link">&para;</a></h2>
<ul>
<li>Each module must be packaged as an RPM. Additionally it  may also be packaged as a <code>tar.gz</code> file.
  <em>(Rationale: RPM is easier to deploy. However, in order not to put up any barriers for potential
  third party users of our software, we keep the <code>tar.gz</code> as a fall-back option.)</em></li>
<li>The RPM must contain correct metadata, and particularly all its dependencies.</li>
<li>The RPM must create all the databases and other resources that the module needs
  to function. <em>(Rationale: we are trying to make installation as easy as possibly.)</em></li>
<li>The RPM should come with reasonable defaults, and <em>if possible</em> install the module
  in a state where it will work without any further configuration. It <em>must not</em> however
  contain any DANS specific configuration settings. <em>(Rationale: we are trying to make installation as easy as possibly.)</em></li>
<li>Configuration that is DANS-specific must be coded in Ansible scripts. <em>(Rationale: try to keep the
  package usable by potential third party users of our software.)</em></li>
<li>Configuration that is generic, but cannot be done by the RPM because it could break other packages
  must be coded in Ansible scripts. An example would be changing the general settings of an RDBMS that
  is needed by our package. <em>(Rationale: try to keep the package usable by potential third party users of our software.)</em></li>
<li>When the package is removed, the RPM should remove all the resources that can safely
  be removed. It should leave resources that could possibly be needed after uninstall,
  such as log files, databases and system users (in most cases).</li>
<li>The RPM must be able to upgrade from only from the release immediately preceding it. Particularly, it must be able 
  to migrate configuration and supporting resources to new requirements. For example if new configuration settings have 
  been added, the RPM upgrade scripts must add those to the existing configuration files with the "reasonable defaults" 
  as values. Thereafter it may still be necessary to change those settings using the Ansible script.
  <em>(Rationale: trying to balance easy-of-use at DANS with genericity. In most cases the reasonable default should be sufficient
  for DANS, making a simple <code>yum upgrade dans.knaw.nl*</code> enough to upgrade the deployment to the state-of-the-art.)</em></li>
</ul>
<h2 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permanent link">&para;</a></h2>
<ul>
<li>Each module should have a <code>README.md</code> file with the following sections. The ones
  marked with (*) are mandatory.<ul>
<li>Title and short description, build status link to travis-ci. (*)</li>
<li>SYNOPSIS (*). This must contain a summary of the supported command line, using the conventions as illustrated
  by the following example. It must be identical to the <code>Usage:</code> part of the output of <code>&lt;command&gt; --help</code>. (This must
  be checked by the <code>ReadmeSpec</code> unit test.)
  <div class="highlight"><pre><span></span><code>  my-program subcommand1 [-o, --option1 &lt;arg&gt;] &lt;explicit-name-of-trail-arg&gt;
  my-program subcommand2 [-f, --flag1][{-m, --mutually-exclusive1|-n,--mutually-exclusive2}]
  my-program subcommand3 [-a, --a-very-long-name-for-simple-option &lt;arg&gt;][-b, --some-boolean] \
      &lt;trail&gt; &lt;trail2&gt; &lt;trail3&gt;...
</code></pre></div>
  In short:<ul>
<li>Options described by <em>short-name</em>, <em>long-name</em> and <em><code>&lt;arg&gt;</code></em>. The long name should be sufficiently clear, so that a
  generic <code>&lt;arg&gt;</code> suffices. For booleans <code>&lt;arg&gt;</code> should of course be left out.</li>
<li>Options should always be optional, meaning they have a reasonable default.</li>
<li>trailing arguments should be meaningful, for example <em><code>&lt;input-directory&gt;</code></em>, etc. </li>
<li>Mutually exclusive options should be grouped in braces.</li>
<li>Repeating trailing arguments indicated with an ellipsis glued to the end of the repeating argument.</li>
</ul>
</li>
<li>DESCRIPTION (*)</li>
<li>ARGUMENTS (*). This must be literally the part of the output of <code>&lt;command&gt; --help</code> after <code>Options:</code>. (This must
  be checked by the <code>ReadmeSpec</code> unit test.) </li>
<li>EXAMPLES. Examples of using the program.</li>
<li>INSTALLATION AND CONFIGURATION (*). How to install and configure the program. Detailed description of the configuration
  settings should be done as comments in the configuration files.</li>
<li>DEVELOPMENT. Any information for developers who whish to contribute to the project.</li>
</ul>
</li>
<li>Sections that become too big should refer to other documentation pages, also located
  in the root of the project, and marked up in markdown.</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Manual" class="md-flex md-footer-nav__link md-footer-nav__link--prev head-type" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                Manual
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        <div>
          
          powered by
          <a href="https://www.mkdocs.org">MkDocs</a>
          and
          <a href="https://squidfunk.github.io/mkdocs-material/">
            Material for MkDocs</a>
          customised by
          <a href="https://github.com/Dans-labs">Dans-labs</a>
        </div>
      </div>
      <div class="md-footer-dans">
  <div>DANS is an institute of KNAW and NWO</div>
  <div>
    <a href="https://dans.knaw.nl/en" title="Data Archiving and Networked Services (DANS)"><img class="md-footer-dans__img" src="../assets/images/DANS.gif" height="50"></a>
    <a target="_blank" href="https://www.knaw.nl/en"><img src="../assets/images/knaw.png" height="50"></a>
    <a target="_blank" href="https://www.nwo.nl/en"><img src="../assets/images/nwo.png" height="50"></a>
  </div>
  <div><i>Driven by data</i></div>
</div>
      
  <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
  <style>.md-footer-social__desc{font-family:"Open Sans",sans-serif;-webkit-font-smoothing:auto}</style>
  <ul class="md-footer-social">
    
    <li class="md-footer-social__li">
      <a href="http://eepurl.com/dvnr8D" class="md-footer-social__link fa fa-envelope-square">
        <span class="md-footer-social__desc">Newsletter</span>
      </a>
    </li>
    
    <li class="md-footer-social__li">
      <a href="https://twitter.com/DANSKNAW" class="md-footer-social__link fa fa-twitter-square">
        <span class="md-footer-social__desc">Twitter</span>
      </a>
    </li>
    
    <li class="md-footer-social__li">
      <a href="https://www.youtube.com/user/DANSDataArchiving" class="md-footer-social__link fa fa-youtube-square">
        <span class="md-footer-social__desc">YouTube</span>
      </a>
    </li>
    
    <li class="md-footer-social__li">
      <a href="https://www.linkedin.com/company/dans" class="md-footer-social__link fa fa-linkedin-square">
        <span class="md-footer-social__desc">LinkedIn</span>
      </a>
    </li>
    

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.f780ca69.js"></script>
      
      <script>app.initialize({version:"1.1.2",url:{base:".."}})</script>
      
    
  </body>
</html>